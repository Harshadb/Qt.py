name: Run PySide6 Tests

on:
  push:
    branches:
      - "*"
  pull_request:
    branches:
      - "*"

jobs:
  test:
    runs-on: ubuntu-22.04

    env:
      QT_PREFERRED_BINDING: PySide6
      PYTHONPATH: "${{ github.workspace }}"

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install EGL mesa
        run: |
          sudo apt-get update -y -qq
          sudo apt-get install -y -qq libegl1-mesa libegl1-mesa-dev libgl1-mesa-glx libgl1-mesa-dev

      - name: Pip install . 
        run: |
          python3.10 -m pip install .

      - name: Pip install PySide6 and dependencies 
        run: |
          python3.10 -m pip install PySide6 nose2 nosepipe six packaging setuptools wheel

      - name: Testing implementation..
        run: |
          python3.10 -m nose2 --verbose tests
        
      - name: Building caveats..
        run: |
          python3.10 -u build_caveats.py

      - name: Testing caveats..
        run: |
          python3.10 -m nose2 --verbose test_caveats

      - name: Testing examples..
        run: |
          cd examples
          python3.10 -m nose2 --verbose loadUi.baseinstance1
          python3.10 -m nose2 --verbose loadUi.baseinstance2
          python3.10 -m nose2 --verbose QtSiteConfig.main
          cd ..
